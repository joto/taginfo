<%
    osm = @trans.t.osm
    page = @trans.t.pages.relation
 %>
var create_flexigrid_for = {
    overview: function(rtype) {
        create_flexigrid('grid-overview', {
            url: '/api/4/relation/stats?rtype=' + encodeURIComponent(rtype),
            colModel: [
                { display: '<%= page.overview.member_type %>', name: 'type', width: 100, sortable: true },
                { display: '<%= page.overview.member_count %>', name: 'count', width: 260, sortable: true, align: 'right' }
            ],
            usepager: false,
            useRp: false,
            preProcess: function(data) {
                return {
                    total: 4,
                    page: 1,
                    rows: jQuery.map(data.data, function(row, i) {
                        return { 'cell': [
                            fmt_type_image(row.type),
                            fmt_with_ts(row.count)
                        ]};
                    })
                };
            }
        });
    },
    roles: function(rtype) {
        create_flexigrid('grid-roles', {
            url: '/api/4/relation/roles?rtype=' + encodeURIComponent(rtype),
            colModel: [
                { display: '<%= osm.relation_member_role %>', name: 'role', width: 250, sortable: true },
                { display: '<span title="<%= page.roles.objects_tooltip %>"><img src="/img/types/all.16.png" width="16" height="16" alt=""/> <%= osm.relation_members %></span>', name: 'count_all_members', width: 250, sortable: true, align: 'center' },
                { display: '<span title="<%= page.roles.nodes_tooltip %>"><img src="/img/types/node.16.png" width="16" height="16" alt=""/> <%= osm.relation_member_nodes %></span>', name: 'count_node_members', width: 250, sortable: true, align: 'center' },
                { display: '<span title="<%= page.roles.ways_tooltip %>"><img src="/img/types/way.16.png" width="16" height="16" alt=""/> <%= osm.relation_member_ways %></span>', name: 'count_way_members', width: 250, sortable: true, align: 'center' },
                { display: '<span title="<%= page.roles.relations_tooltip %>"><img src="/img/types/relation.16.png" width="16" height="16" alt=""/> <%= osm.relation_member_relations %></span>', name: 'count_relation_members', width: 250, sortable: true, align: 'center' },
            ],
            searchitems: [
                { display: '<%= osm.relation_member_role %>', name: 'role' }
            ],
            sortname: 'count_all_members',
            sortorder: 'desc',
            preProcess: function(data) {
                data.rows = jQuery.map(data.data, function(row, i) {
                    return { 'cell': [
                        fmt_role(row.role),
                        fmt_value_with_percent(row.count_all_members, row.count_all_members_fraction),
                        fmt_value_with_percent(row.count_node_members, row.count_node_members_fraction),
                        fmt_value_with_percent(row.count_way_members, row.count_way_members_fraction),
                        fmt_value_with_percent(row.count_relation_members, row.count_relation_members_fraction)
                    ] };
                });
                return data;
            }
        });
    }
};

function page_init() {
    jQuery('#josm_button').bind('click', function() {
        jQuery('#josmiframe')[0].src = jQuery('#josm_button')[0].href;
        return false;
    });

    up = function() { window.location = '/relations'; };
    page_init2();
}
